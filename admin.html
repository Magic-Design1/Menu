<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Admin Console</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --primary: #2563eb; --dark: #0f172a; --bg: #f8fafc; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        .admin-nav { 
            background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000;
        }
        .admin-logo { display: flex; align-items: center; gap: 10px; font-weight: 800; font-size: 1.2rem; }
        .admin-logo img { width: 40px; height: 40px; border-radius: 10px; background: #eee; object-fit: cover; }

        .main-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; padding: 25px; max-width: 1400px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        .admin-box { background: white; border-radius: 30px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.02); border: 1px solid #f1f5f9; }
        .admin-box h2 { margin-top: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; color: var(--dark); }

        .order-row { 
            background: #f8fafc; border-radius: 20px; padding: 15px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent; transition: 0.3s;
        }
        .order-row:hover { border-color: var(--primary); background: white; }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 0.85rem; color: #64748b; }
        input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; font-family: inherit; box-sizing: border-box; }
        .btn-p { background: var(--primary); color: white; border: none; padding: 14px 25px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-p:hover { opacity: 0.9; transform: translateY(-2px); }

        .stat-card { background: var(--dark); color: white; padding: 20px; border-radius: 25px; text-align: center; }
        .stat-card span { font-size: 1.8rem; font-weight: 800; display: block; margin-top: 5px; }

        .call-item { background: #fee2e2; color: #b91c1c; padding: 12px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; font-weight: 700; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    </style>
</head>
<body>

<nav class="admin-nav">
    <div class="admin-logo">
        <img id="nav-logo" src="https://via.placeholder.com/40">
        <span id="nav-name">Admin Console</span>
    </div>
    <div id="status-live" style="background:#dcfce7; color:#15803d; padding:5px 15px; border-radius:50px; font-size:0.75rem; font-weight:800;">â— SYSTEM LIVE</div>
</nav>

<div class="main-grid">
    <div class="admin-box" style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; background: none; box-shadow: none; padding: 0; border: none;">
        <div class="stat-card">Total Revenue<span id="stat-rev">$0.00</span></div>
        <div class="stat-card" style="background:var(--primary)">Active Orders<span id="stat-active">0</span></div>
        <div class="stat-card" style="background:#10b981">Waiter Calls<span id="stat-calls">0</span></div>
    </div>

    <div class="admin-box" id="waiter-section" style="display:none;">
        <h2>ğŸ›ï¸ Waiter Needed</h2>
        <div id="waiter-list"></div>
    </div>

    <div class="admin-box" style="grid-column: span 2;">
        <h2>ğŸ³ Live Kitchen Queue</h2>
        <div id="order-list"></div>
    </div>

    <div class="admin-box">
        <h2>ğŸ·ï¸ Add New Item</h2>
        <div class="input-group"><label>Product Name</label><input type="text" id="p-name" placeholder="e.g. Wagyu Burger"></div>
        <div class="input-group"><label>Price ($)</label><input type="number" id="p-price" placeholder="0.00"></div>
        <div class="input-group"><label>Image</label><input type="file" id="p-img" accept="image/*"></div>
        <button class="btn-p" onclick="addItem()">Add to Menu</button>
        
        <h2 style="margin-top:40px;">ğŸ¨ Global Settings</h2>
        <div class="input-group"><label>Brand Name</label><input type="text" id="set-name"></div>
        <div class="input-group"><label>Theme Color</label><input type="color" id="set-color" style="height:50px; cursor:pointer;"></div>
        <div class="input-group"><label>Background Image</label><input type="file" id="set-bg"></div>
        <div class="input-group"><label>Logo Image</label><input type="file" id="set-logo"></div>
        <button class="btn-p" onclick="saveSettings()" style="background:var(--dark)">Save Identity</button>
    </div>
</div>

<script>
    // 1. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø£Ù…Ø§Ù†
    let db = JSON.parse(localStorage.getItem('elite_v5_db')) || { 
        name: 'Elite Admin', 
        primaryColor: '#2563eb', 
        products: [], 
        orders: [], 
        waiterCalls: [], 
        bg:'', 
        logo:'' 
    };

    function sync() {
        localStorage.setItem('elite_v5_db', JSON.stringify(db));
        window.dispatchEvent(new Event('storage'));
        render();
    }

    function render() {
        if(!db) return;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙˆÙŠØ©
        document.getElementById('nav-name').innerText = db.name || 'Admin Console';
        document.documentElement.style.setProperty('--primary', db.primaryColor || '#2563eb');
        if(db.logo) document.getElementById('nav-logo').src = db.logo;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        const activeOrders = db.orders.filter(o => o.status === 'Pending');
        const revenue = db.orders.filter(o => o.status === 'Finished').reduce((a, b) => a + parseFloat(b.total.replace('$', '')), 0);
        
        document.getElementById('stat-rev').innerText = "$" + revenue.toFixed(2);
        document.getElementById('stat-active').innerText = activeOrders.length;
        document.getElementById('stat-calls').innerText = db.waiterCalls.length;

        // Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆÙŠØªØ±
        const wSection = document.getElementById('waiter-section');
        if(db.waiterCalls && db.waiterCalls.length > 0) {
            wSection.style.display = 'block';
            document.getElementById('waiter-list').innerHTML = db.waiterCalls.map(c => `
                <div class="call-item">
                    Table ${c.table} is calling! ğŸ›ï¸
                    <button onclick="clearCall(${c.id})" style="background:white; border:none; padding:5px 10px; border-radius:8px; cursor:pointer; font-weight:800;">OK</button>
                </div>
            `).join('');
        } else { wSection.style.display = 'none'; }

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        document.getElementById('order-list').innerHTML = db.orders.map(o => `
            <div class="order-row">
                <div>
                    <b style="font-size:1.1rem;">Table ${o.table}</b> <small style="color:#64748b; margin-left:10px;">${o.time}</small>
                    <div style="font-size:0.85rem; color:#64748b; margin-top:5px;">${o.items.map(i => `${i.qty}x ${i.name}`).join(', ')}</div>
                    <b style="color:var(--primary);">${o.total}</b>
                </div>
                <div>
                    ${o.status === 'Pending' ? 
                    `<button onclick="updateStatus(${o.id}, 'Finished')" class="btn-p" style="padding:10px 20px; width:auto;">Ready âœ“</button>` : 
                    `<span style="color:#10b981; font-weight:800;">Served</span>`}
                </div>
            </div>
        `).reverse().join('') || '<p style="text-align:center; padding:30px; opacity:0.5;">No orders in queue.</p>';
    }

    function addItem() {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        const file = document.getElementById('p-img').files[0];
        if(!name || !price || !file) return Swal.fire('Error', 'Please fill all fields', 'error');
        
        const r = new FileReader();
        r.onload = (e) => {
            db.products.push({ id: Date.now(), name, price: parseFloat(price), img: e.target.result, inStock: true });
            sync();
            Swal.fire('Success', 'Item added to menu', 'success');
            document.getElementById('p-name').value = '';
            document.getElementById('p-price').value = '';
        };
        r.readAsDataURL(file);
    }

    function saveSettings() {
        db.name = document.getElementById('set-name').value || db.name;
        db.primaryColor = document.getElementById('set-color').value || db.primaryColor;
        
        const logoFile = document.getElementById('set-logo').files[0];
        const bgFile = document.getElementById('set-bg').files[0];

        const readFile = (file, key, callback) => {
            if(file) {
                const r = new FileReader();
                r.onload = (e) => { db[key] = e.target.result; callback(); };
                r.readAsDataURL(file);
            } else { callback(); }
        };

        readFile(logoFile, 'logo', () => {
            readFile(bgFile, 'bg', () => {
                sync();
                Swal.fire('Identity Updated!', 'Changes applied successfully', 'success');
            });
        });
    }

    function updateStatus(id, stat) {
        const idx = db.orders.findIndex(o => o.id === id);
        if(idx !== -1) { db.orders[idx].status = stat; sync(); }
    }

    function clearCall(id) {
        db.waiterCalls = db.waiterCalls.filter(c => c.id !== id);
        sync();
    }

    // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
    window.addEventListener('storage', () => {
        const data = localStorage.getItem('elite_v5_db');
        if(data) { db = JSON.parse(data); render(); }
    });
    
    // Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
    document.getElementById('set-name').value = db.name;
    document.getElementById('set-color').value = db.primaryColor;
    render();
</script>       
</body>
</html>