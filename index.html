<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Guest Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --primary: #2563eb; --accent: #3b82f6; --bg: #fdfdfd; --text: #0f172a; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; transition: 0.3s; }
        
        header { position: relative; height: 260px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?q=80&w=1000') no-repeat center center; background-size: cover; border-radius: 0 0 50px 50px; }
        
        /* Color Picker */
        .color-picker-wrapper { position: absolute; top: 20px; left: 20px; z-index: 100; display: flex; align-items: center; gap: 8px; background: rgba(0,0,0,0.5); padding: 5px 12px; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); color: white; font-size: 0.7rem; font-weight: 700; }
        #theme-color { cursor: pointer; border: none; width: 24px; height: 24px; background: none; border-radius: 50%; padding: 0; }
        #theme-color::-webkit-color-swatch { border-radius: 50%; border: 2px solid white; }

        .waiter-call-btn { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); color: white; padding: 10px 18px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); z-index: 100; }
        .brand-name { font-size: 2rem; font-weight: 800; color: white; text-shadow: 0 4px 15px rgba(0,0,0,0.4); margin: 0; }
        
        /* Navigation Tabs */
        .nav-bar { display: flex; background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); margin: -30px 20px 10px; padding: 6px; border-radius: 22px; box-shadow: 0 10px 30px rgba(0,0,0,0.06); border: 1px solid white; }
        .nav-item { flex: 1; padding: 12px; text-align: center; font-weight: 700; cursor: pointer; border-radius: 18px; transition: 0.3s; color: #64748b; font-size: 0.9rem; }
        .nav-item.active { background: var(--primary); color: white; box-shadow: 0 8px 20px rgba(37, 99, 235, 0.2); }

        /* Category Filter Buttons */
        .category-scroller { display: flex; overflow-x: auto; padding: 10px 20px; gap: 10px; scrollbar-width: none; }
        .category-scroller::-webkit-scrollbar { display: none; }
        .cat-btn { padding: 10px 20px; background: #f1f5f9; border-radius: 50px; white-space: nowrap; font-size: 0.8rem; font-weight: 700; cursor: pointer; border: 1px solid #e2e8f0; transition: 0.2s; color: #475569; }
        .cat-btn.active { background: var(--text); color: white; border-color: var(--text); }
        
        .filter-toggle { display: flex; align-items: center; justify-content: space-between; padding: 0 25px 15px; }
        .filter-toggle span { font-size: 0.85rem; font-weight: 700; color: #64748b; }
        
        /* Toggle Switch Style */
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Product Cards */
        .container { padding: 0 20px; }
        .food-card { background: white; border-radius: 28px; padding: 15px; margin-bottom: 18px; display: flex; gap: 15px; align-items: center; box-shadow: 0 8px 20px rgba(0,0,0,0.02); border: 1px solid #f1f5f9; position: relative; overflow: hidden; }
        .food-img { width: 100px; height: 100px; border-radius: 20px; object-fit: cover; }
        .food-info { flex: 1; }
        .food-info h3 { margin: 0; font-size: 1rem; font-weight: 700; }
        .food-info p { color: var(--primary); font-weight: 800; font-size: 1.1rem; margin: 4px 0; }
        .qty-box { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
        .q-btn { width: 30px; height: 30px; border-radius: 10px; border: none; background: #f1f5f9; font-weight: 800; cursor: pointer; }
        .add-btn { background: var(--primary); color: white; border: none; padding: 9px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; flex-grow: 1; font-size: 0.85rem; }
        
        .out-of-stock-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.7); z-index: 2; display: flex; align-items: center; justify-content: center; color: #ef4444; font-weight: 900; font-size: 0.8rem; backdrop-filter: grayscale(1); pointer-events: none; }

        .cart-trigger { position: fixed; bottom: 25px; right: 25px; width: 65px; height: 65px; background: var(--text); border-radius: 22px; display: flex; align-items: center; justify-content: center; box-shadow: 0 15px 35px rgba(0,0,0,0.2); cursor: pointer; z-index: 999; border: 2px solid var(--primary); }
        .cart-badge { position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; width: 22px; height: 22px; border-radius: 50%; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; font-weight: 800; }
        
        .track-card { background: white; border-radius: 22px; padding: 18px; margin-bottom: 15px; border-left: 6px solid var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.02); }
    </style>
</head>
<body>

<header id="app-header">
    <div class="color-picker-wrapper">
        <span>Theme</span>
        <input type="color" id="theme-color" value="#2563eb" oninput="changeThemeColor(this.value)">
    </div>
    <div onclick="callWaiter()" class="waiter-call-btn">üõéÔ∏è Call Waiter</div>
    <h1 class="brand-name">ELITE MENU</h1>
</header>

<div class="nav-bar">
    <div class="nav-item active" id="btn-menu" onclick="switchTab('menu', this)">Menu</div>
    <div class="nav-item" id="btn-orders" onclick="switchTab('orders', this)">My Orders</div>
</div>

<div id="menu-controls">
    <div class="category-scroller">
        <button class="cat-btn active" onclick="filterCat('all', this)">All Items</button>
        <button class="cat-btn" onclick="filterCat('meals', this)">üçî Main Meals</button>
        <button class="cat-btn" onclick="filterCat('drinks', this)">‚òï Cold Drinks</button>
        <button class="cat-btn" onclick="filterCat('sweets', this)">üç∞ Desserts</button>
    </div>

    <div class="filter-toggle">
        <span>Show Available Only</span>
        <label class="switch">
            <input type="checkbox" id="stock-filter" onchange="renderMenu()">
            <span class="slider"></span>
        </label>
    </div>
</div>

<div id="view-menu" class="container"></div>
<div id="view-orders" class="container" style="display:none;"></div>

<div class="cart-trigger" id="cart-fab" style="display:none;" onclick="openCart()">
    <div class="cart-badge" id="cart-count">0</div>
    <span style="font-size: 1.6rem;">üõí</span>
</div>

<script>
    // Updated Products Data organized by Category
    const productsData = [
        // MEALS
        { id: 1, name: 'Premium Cheeseburger', category: 'meals', price: 12.90, img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=500', inStock: true },
        { id: 2, name: 'Italian Margherita Pizza', category: 'meals', price: 14.50, img: 'https://images.unsplash.com/photo-1604382354936-07c5d9983bd3?q=80&w=500', inStock: true },
        { id: 3, name: 'Crispy Chicken Wings', category: 'meals', price: 9.90, img: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=500', inStock: false },
        
        // DRINKS
        { id: 4, name: 'Iced Caramel Latte', category: 'drinks', price: 5.50, img: 'https://images.unsplash.com/photo-1517701604599-bb29b565090c?q=80&w=500', inStock: true },
        { id: 5, name: 'Fresh Orange Juice', category: 'drinks', price: 4.00, img: 'https://images.unsplash.com/photo-1613478223719-2ab802602423?q=80&w=500', inStock: true },
        { id: 6, name: 'Classic Mojito', category: 'drinks', price: 6.50, img: 'https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?q=80&w=500', inStock: true },
        
        // SWEETS
        { id: 7, name: 'Chocolate Lava Cake', category: 'sweets', price: 7.50, img: 'https://images.unsplash.com/photo-1624353335558-43d95f8a8f61?q=80&w=500', inStock: true },
        { id: 8, name: 'New York Cheesecake', category: 'sweets', price: 8.00, img: 'https://images.unsplash.com/photo-1533134242443-d4fd215305ad?q=80&w=500', inStock: false }
    ];

    let db = { products: productsData, primaryColor: '#2563eb', orders: [] };
    let cart = {};
    let currentCat = 'all';

    function changeThemeColor(color) {
        document.documentElement.style.setProperty('--primary', color);
        db.primaryColor = color;
        saveData();
    }

    function saveData() {
        localStorage.setItem('elite_v5_db', JSON.stringify(db));
    }

    function sync() {
        const live = localStorage.getItem('elite_v5_db');
        if(live) { 
            db = JSON.parse(live);
            if(db.primaryColor) {
                document.documentElement.style.setProperty('--primary', db.primaryColor);
                document.getElementById('theme-color').value = db.primaryColor;
            }
        }
        renderMenu();
    }

    function filterCat(cat, btn) {
        currentCat = cat;
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderMenu();
    }

    function renderMenu() {
        const menuDiv = document.getElementById('view-menu');
        const showOnlyStock = document.getElementById('stock-filter').checked;
        
        // Filter Logic: Check category AND stock status
        let filtered = db.products.filter(p => {
            const matchesCategory = (currentCat === 'all' || p.category === currentCat);
            const matchesStock = (!showOnlyStock || p.inStock);
            return matchesCategory && matchesStock;
        });

        menuDiv.innerHTML = filtered.map(p => `
            <div class="food-card">
                ${!p.inStock ? '<div class="out-of-stock-overlay">SOLD OUT</div>' : ''}
                <img src="${p.img}" class="food-img">
                <div class="food-info">
                    <h3>${p.name}</h3>
                    <p>$${p.price.toFixed(2)}</p>
                    <div class="qty-box">
                        <button class="q-btn" onclick="changeQtyUI(${p.id}, -1)">-</button>
                        <span id="ui-qty-${p.id}" style="font-weight:800; width:20px; text-align:center;">1</span>
                        <button class="q-btn" onclick="changeQtyUI(${p.id}, 1)">+</button>
                        <button class="add-btn" onclick="addToCart(${p.id})" ${!p.inStock ? 'disabled' : ''}>Add</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function changeQtyUI(id, delta) {
        const el = document.getElementById(`ui-qty-${id}`);
        let val = parseInt(el.innerText) + delta;
        if(val >= 1) el.innerText = val;
    }

    function addToCart(id) {
        const p = db.products.find(x => x.id === id);
        const qty = parseInt(document.getElementById(`ui-qty-${id}`).innerText);
        if(cart[id]) cart[id].qty += qty; else cart[id] = {...p, qty};
        document.getElementById(`ui-qty-${id}`).innerText = "1";
        updateCartFab();
        Swal.fire({ title: 'Added!', text: p.name, icon: 'success', timer: 800, showConfirmButton: false, toast: true, position: 'top' });
    }

    function updateCartFab() {
        const count = Object.values(cart).reduce((a, b) => a + b.qty, 0);
        document.getElementById('cart-count').innerText = count;
        document.getElementById('cart-fab').style.display = count > 0 ? 'flex' : 'none';
    }

    async function openCart() {
        const subtotal = Object.values(cart).reduce((a, b) => a + (b.price * b.qty), 0);
        const total = subtotal + (subtotal * 0.14);
        let itemsHtml = Object.values(cart).map(i => `<div style="display:flex; justify-content:space-between; margin-bottom:8px;"><span>${i.qty}x ${i.name}</span><b>$${(i.price * i.qty).toFixed(2)}</b></div>`).join('');

        const { isConfirmed } = await Swal.fire({
            title: 'Checkout',
            html: `<div style="text-align:left; border-top:1px solid #eee; padding-top:10px;">${itemsHtml}</div>
                   <div style="margin-top:10px; font-weight:800; display:flex; justify-content:space-between;"><span>Total (Inc. VAT)</span><span>$${total.toFixed(2)}</span></div>`,
            showCancelButton: true, confirmButtonText: 'Confirm', confirmButtonColor: db.primaryColor
        });

        if(isConfirmed) {
            db.orders.unshift({ id: Date.now(), items: Object.values(cart), total: "$"+total.toFixed(2), time: new Date().toLocaleTimeString() });
            saveData();
            cart = {}; updateCartFab();
            switchTab('orders', document.getElementById('btn-orders'));
        }
    }

    function renderOrders() {
        const ordersDiv = document.getElementById('view-orders');
        ordersDiv.innerHTML = db.orders.map(o => `
            <div class="track-card">
                <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#64748b;"><span>Order #${o.id.toString().slice(-4)}</span><span>${o.time}</span></div>
                <div style="margin:8px 0; font-weight:700;">${o.items.map(i => i.name).join(', ')}</div>
                <div style="text-align:right; font-weight:800; color:var(--primary);">${o.total}</div>
            </div>
        `).join('') || '<div style="text-align:center; padding:50px; opacity:0.5;">No orders found.</div>';
    }

    function switchTab(tab, el) {
        document.getElementById('view-menu').style.display = tab === 'menu' ? 'block' : 'none';
        document.getElementById('menu-controls').style.display = tab === 'menu' ? 'block' : 'none';
        document.getElementById('view-orders').style.display = tab === 'orders' ? 'block' : 'none';
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        if(tab === 'orders') renderOrders();
    }

    function callWaiter() {
        Swal.fire({ title: 'üõéÔ∏è Waiter Called', icon: 'info', confirmButtonColor: db.primaryColor });
    }

    sync();
</script>
</body>
</html>
