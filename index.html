<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Digital Menu</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --white: #ffffff; --text: #0f172a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg); 
            margin: 0; 
            color: var(--text); 
            padding-bottom: 120px; /* ŸÖÿ≥ÿßÿ≠ÿ© ŸÑŸÑÿ≥ŸÑÿ© */
        }

        /* Header UI - Improved */
        header { 
            height: 160px; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑŸÉŸàŸÅÿ± ŸÇŸÑŸäŸÑÿßŸã */
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?q=80&w=1000') center/cover;
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            position: relative; 
            border-radius: 0 0 40px 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 45px; /* ŸÖÿ≥ÿßÿ≠ÿ© ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿ™ÿ≠ÿ™ ÿßŸÑŸÉŸàŸÅÿ± */
        }

        .theme-picker { 
            position: absolute; top: 15px; left: 15px; 
            background: rgba(255,255,255,0.25); 
            backdrop-filter: blur(10px); 
            padding: 5px 12px; 
            border-radius: 12px; 
            border: 1px solid rgba(255,255,255,0.3);
            display: flex; align-items: center; gap: 8px;
            color: white; font-size: 0.75rem; font-weight: 700;
        }
        .theme-picker input { cursor: pointer; border: none; width: 20px; height: 20px; background: none; border-radius: 50%; padding:0; }

        .waiter-btn { 
            position: absolute; top: 15px; right: 15px; 
            background: var(--white); color: var(--text); 
            padding: 10px 18px; border-radius: 14px; 
            font-weight: 800; border: none; cursor: pointer; 
            font-size: 0.75rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }

        /* Tabs UI - Floating over the edge */
        .tabs { 
            display: flex; background: var(--white); 
            margin: -40px 20px 20px; /* ÿ±ŸÅÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÑÿ™ÿØÿßÿÆŸÑ ŸÖÿπ ÿßŸÑŸÉŸàŸÅÿ± */
            border-radius: 20px; padding: 6px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            position: relative; z-index: 100;
            border: 1px solid #f1f5f9;
        }
        .tab-btn { 
            flex: 1; padding: 14px; border: none; background: none; 
            font-weight: 700; cursor: pointer; border-radius: 15px; 
            color: #64748b; transition: 0.3s; font-size: 0.9rem; 
        }
        .tab-btn.active { background: var(--primary); color: white; }

        /* Container & Cards */
        .container { padding: 0 20px; display: none; }
        .container.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--white); border-radius: 24px; padding: 15px; margin-bottom: 15px; display: flex; gap: 15px; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.03); border: 1px solid #f1f5f9; }
        .card img { width: 95px; height: 95px; border-radius: 18px; object-fit: cover; background: #f1f5f9; }
        .card-info { flex: 1; }
        .card-info h3 { margin: 0; font-size: 1rem; font-weight: 700; color: var(--text); }
        .card-info .price { color: var(--primary); font-weight: 800; font-size: 1.1rem; margin: 6px 0; }
        
        .qty-row { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; }
        .qty-controls { display: flex; align-items: center; gap: 10px; background: #f8fafc; padding: 4px 8px; border-radius: 10px; }
        .qty-btn { width: 30px; height: 30px; border-radius: 8px; border: none; background: var(--white); font-weight: 800; cursor: pointer; color: var(--text); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .add-btn { background: var(--primary); color: white; border: none; padding: 10px 18px; border-radius: 12px; font-weight: 800; cursor: pointer; font-size: 0.8rem; box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2); }

        /* Square Cart Button */
        .cart-square { 
            position: fixed; bottom: 30px; right: 25px; width: 70px; height: 70px; 
            background: var(--text); color: white; border-radius: 22px; 
            display: none; align-items: center; justify-content: center; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.3); z-index: 1000; cursor: pointer; border: 3px solid var(--primary);
        }
        .cart-badge { position: absolute; top: -10px; left: -10px; background: var(--primary); color: white; min-width: 26px; height: 26px; border-radius: 8px; font-size: 0.8rem; font-weight: 800; display: flex; align-items: center; justify-content: center; border: 2px solid var(--white); }

        /* Track UI */
        .order-row { background: white; padding: 18px; border-radius: 20px; margin-bottom: 12px; border-left: 5px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.02); }
        .status-pill { font-size: 0.7rem; padding: 4px 12px; border-radius: 50px; background: #f1f5f9; font-weight: 800; text-transform: uppercase; color: var(--primary); }
    </style>
</head>
<body>

<header>
    <div class="theme-picker">
        <input type="color" id="themeInput" value="#2563eb" oninput="applyTheme(this.value)">
        <span>Color</span>
    </div>
    <button class="waiter-btn" onclick="callWaiter()">üõéÔ∏è CALL WAITER</button>
    <h1 style="color:white; font-weight:800; letter-spacing: -1px; margin:0;">ELITE MENU</h1>
</header>

<div class="tabs">
    <button class="tab-btn active" onclick="switchTab('menu', this)">Browse Menu</button>
    <button class="tab-btn" onclick="switchTab('track', this)">My Orders</button>
</div>

<div id="menu-view" class="container active">
    <div id="product-list"></div>
</div>

<div id="track-view" class="container">
    <h3 style="margin: 0 0 15px 5px; font-size: 1.1rem;">Track Your Orders</h3>
    <div id="my-orders-list"></div>
</div>

<div class="cart-square" id="cart-square-btn" onclick="openCheckout()">
    <div class="cart-badge" id="cart-badge-count">0</div>
    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwsS6zErft-eK55CndjMFwTO-kHsMX-WxeXvQHgwJ1W_eHotYOMmn715lKuw2IKsbPwBA/exec";
    const TABLE_ID = "05";

    let menuItems = [
        { id: 1, name: "Double Cheese Burger", price: 14.50, img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=300" },
        { id: 2, name: "Pepperoni Passion Pizza", price: 18.00, img: "https://images.unsplash.com/photo-1604382354936-07c5d9983bd3?w=300" },
        { id: 3, name: "Iced Caramel Macchiato", price: 6.00, img: "https://images.unsplash.com/photo-1517701550927-30cf4ba1dba5?w=300" },
        { id: 4, name: "Molten Chocolate Cake", price: 8.50, img: "https://images.unsplash.com/photo-1624353365286-3f8d62daad51?w=300" }
    ];

    let cart = {};
    let orderHistory = JSON.parse(localStorage.getItem('elite_history')) || [];

    function applyTheme(color) {
        document.documentElement.style.setProperty('--primary', color);
        localStorage.setItem('elite_theme_color', color);
    }

    function switchTab(view, btn) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(view + '-view').classList.add('active');
        btn.classList.add('active');
        if(view === 'track') syncHistory();
    }

    function renderMenu() {
        document.getElementById('product-list').innerHTML = menuItems.map(p => `
            <div class="card">
                <img src="${p.img}">
                <div class="card-info">
                    <h3>${p.name}</h3>
                    <div class="price">$${p.price.toFixed(2)}</div>
                    <div class="qty-row">
                        <div class="qty-controls">
                            <button class="qty-btn" onclick="changeQtyUI(${p.id}, -1)">-</button>
                            <span id="qty-disp-${p.id}" style="font-weight:800; width:25px; text-align:center;">1</span>
                            <button class="qty-btn" onclick="changeQtyUI(${p.id}, 1)">+</button>
                        </div>
                        <button class="add-btn" onclick="addToCart(${p.id})">ADD</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function changeQtyUI(id, delta) {
        const span = document.getElementById(`qty-disp-${id}`);
        let current = parseInt(span.innerText);
        if(current + delta >= 1) span.innerText = current + delta;
    }

    function addToCart(id) {
        const item = menuItems.find(x => x.id === id);
        const qty = parseInt(document.getElementById(`qty-disp-${id}`).innerText);
        if(cart[id]) cart[id].qty += qty; else cart[id] = {...item, qty: qty};
        
        document.getElementById(`qty-disp-${id}`).innerText = "1";
        updateCartUI();
        Swal.fire({ title: 'Added to cart', icon: 'success', toast: true, position: 'top', showConfirmButton: false, timer: 1500 });
    }

    function updateCartUI() {
        const count = Object.values(cart).reduce((a, b) => a + b.qty, 0);
        document.getElementById('cart-square-btn').style.display = count > 0 ? 'flex' : 'none';
        document.getElementById('cart-badge-count').innerText = count;
    }

    async function openCheckout() {
        const items = Object.values(cart);
        const subtotal = items.reduce((a, b) => a + (b.price * b.qty), 0);
        const tax = subtotal * 0.14;
        const total = subtotal + tax;

        const { isConfirmed } = await Swal.fire({
            title: 'Order Summary',
            html: `<div style="text-align:left; font-size:0.9rem; line-height:1.6;">
                ${items.map(i => `<div style="display:flex; justify-content:space-between;"><span>${i.qty}x ${i.name}</span> <span>$${(i.price*i.qty).toFixed(2)}</span></div>`).join('')}
                <hr style="border:0; border-top:1px solid #eee; margin:10px 0;">
                <div style="display:flex; justify-content:space-between;"><span>Subtotal:</span> <span>$${subtotal.toFixed(2)}</span></div>
                <div style="display:flex; justify-content:space-between;"><span>VAT (14%):</span> <span>$${tax.toFixed(2)}</span></div>
                <div style="display:flex; justify-content:space-between; font-weight:800; color:var(--primary); font-size:1.1rem; margin-top:5px;">
                    <span>Grand Total:</span> <span>$${total.toFixed(2)}</span>
                </div>
            </div>`,
            showCancelButton: true, confirmButtonText: 'Confirm Order', confirmButtonColor: '#0f172a'
        });

        if(isConfirmed) {
            Swal.fire({ title: 'Sending...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
            const oId = Date.now();
            const payload = { type: 'order', id: oId, table: TABLE_ID, items: items, total: "$" + total.toFixed(2), status: 'Pending' };

            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                orderHistory.push(oId);
                localStorage.setItem('elite_history', JSON.stringify(orderHistory));
                cart = {};
                updateCartUI();
                Swal.fire('Ordered!', 'Kitchen is preparing your meal.', 'success');
            } catch(e) { Swal.fire('Error', 'Network error. Try again.', 'error'); }
        }
    }

    async function syncHistory() {
        try {
            const res = await fetch(SCRIPT_URL);
            const data = await res.json();
            const filtered = data.filter(o => orderHistory.includes(Number(o.id)));
            
            document.getElementById('my-orders-list').innerHTML = filtered.reverse().map(o => `
                <div class="order-row">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <b style="font-size:0.9rem;">Order #${String(o.id).slice(-4)}</b>
                        <span class="status-pill">${o.status}</span>
                    </div>
                    <div style="font-size:0.8rem; margin-top:8px; color:#64748b; font-weight:600;">${o.total} ‚Ä¢ ${o.items.length} Items</div>
                </div>
            `).join('') || '<p style="text-align:center; opacity:0.5; margin-top:30px;">No active orders yet.</p>';
        } catch(e) { console.error("Sync error"); }
    }

    async function callWaiter() {
        // ÿ±ÿ≥ÿßŸÑÿ© ŸÅŸàÿ±Ÿäÿ© ŸÑŸÑÿπŸÖŸäŸÑ ŸÑÿπÿØŸÖ ÿßŸÑÿ¥ÿπŸàÿ± ÿ®ÿßŸÑÿ™ÿ£ÿÆŸäÿ±
        Swal.fire({ title: 'üõéÔ∏è Waiter Called', text: 'Someone will be with you shortly.', icon: 'info', timer: 2000, showConfirmButton: false });
        
        // ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ŸÅŸä ÿßŸÑÿÆŸÑŸÅŸäÿ©
        fetch(SCRIPT_URL, { 
            method: 'POST', 
            mode: 'no-cors', 
            body: JSON.stringify({type:'waiter', table: TABLE_ID})
        }).catch(err => console.log("Silent error sending waiter call"));
    }

    const savedColor = localStorage.getItem('elite_theme_color');
    if(savedColor) applyTheme(savedColor);
    renderMenu();
</script>
</body>
</html>
